services:
  open-deep-research:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        MODE: ${MODE:-development}
    container_name: open-deep-research
    # Port exposure disabled for security (access via Docker network only)
    # Uncomment the following lines for debugging/direct API access:
    # ports:
    #   - "${PORT:-2024}:2024"
    environment:
      # LLM API Keys
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      GOOGLE_API_KEY: ${GOOGLE_API_KEY:-}
      DEEPSEEK_API_KEY: ${DEEPSEEK_API_KEY:-}
      
      # Search API Keys
      TAVILY_API_KEY: ${TAVILY_API_KEY:-}
      EXA_API_KEY: ${EXA_API_KEY:-}
      
      # LangSmith Configuration (optional)
      LANGSMITH_API_KEY: ${LANGSMITH_API_KEY:-}
      LANGSMITH_PROJECT: ${LANGSMITH_PROJECT:-}
      LANGSMITH_TRACING: ${LANGSMITH_TRACING:-false}
      
      # Container Configuration
      MODE: ${MODE:-development}
      HOST: 0.0.0.0
      PORT: 2024
      PYTHONUNBUFFERED: 1
      PYTHONDONTWRITEBYTECODE: 1
      
    restart: unless-stopped
    
    networks:
      - deep-research-network
      - external-network
    
    healthcheck:
      test: ["CMD", "python", "-c", "import http.client; c=http.client.HTTPConnection('127.0.0.1',2024,timeout=5);c.request('GET','/docs');r=c.getresponse();exit(0 if r.status==200 else 1)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  deep-research-network:
    driver: bridge
  external-network:
    external: true
    name: ${EXTERNAL_NETWORK:-webui-net}
